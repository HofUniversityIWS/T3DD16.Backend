<h1>Session Module</h1>

<f:if condition="{creationDone}">
	<f:then>
		<f:if condition="{incompleteSessions}">
			<f:then>
				<div class="alert alert-warning">
					<strong>{incompleteSessions -> f:count()} session(s) could not be scheduled</strong>
					<ul>
						<f:for each="{incompleteSessions}" as="incompleteSession">
							<li>{incompleteSession.title}</li>
						</f:for>
					</ul>
				</div>
			</f:then>
			<f:else>
				<div class="alert alert-success">
					Successfully created first timetable
				</div>
			</f:else>
		</f:if>
	</f:then>
</f:if>


<div role="tabpanel">
<ul class="nav nav-tabs t3js-tabs" role="tablist" id="tabs-DDST" data-store-last-tab="1">
	<li role="presentation" class="t3js-tabmenu-item">
		<a href="#DDST-1" title="" aria-controls="DDST-1" role="tab" data-toggle="tab">
			Unassigned Sessions
		</a>
	</li>
	<li role="presentation" class="t3js-tabmenu-item">
		<a href="#DDST-2" title="" aria-controls="DDST-2" role="tab" data-toggle="tab">
			Tools
		</a>
	</li>
</ul>
<div class="tab-content clearfix">
	<div role="tabpanel" class="tab-pane" id="DDST-1">

		<div id="unassigned-sessions" class="col-xs-9">
			<f:if condition="{unassigned}">
			<f:for each="{unassigned}" as="event">
				<!-- changed made here need to be done in js as well! -->
				<div class="fc-event unscheduled-event col-xs-3" data-id="{event.__identity}" data-title="{event.title}">{event.title}</div>
			</f:for>
			</f:if>
		</div>

		<div class="col-xs-3">
			<div id="unschedule-area">
				<p>Drop Events here in order to unschedule.</p>
			</div>
		</div>
	</div>
	<div role="tabpanel" class="tab-pane" id="DDST-2">
		<div id="rivet-container">
			<div class="col-xs-5">
				<h3>Analyze a selected Slot</h3>
				<p rv-unless="selection.enabled" class="help-block">
					Draw a selection in calendar and press the button. This will show you a short summary about the
					sessions in this time slot.
				</p>
				<table rv-if="selection.enabled" class="table table-bordered">
					<tr>
						<td><strong>Begin</strong></td>
						<td>{selection.start | date}</td>
					</tr>
					<tr>
						<td><strong>End</strong></td>
						<td>{selection.end | date}</td>
					</tr>
				</table>
				<button class="btn btn-default btn-block" rv-enabled="selection.enabled" rv-on-click="actions.analyze">Analyze</button>
			</div>
			<div class="col-xs-5">
				<h3>Swap two Sessions</h3>
				<table rv-if="swap.sessions" class="table table-bordered">
					<tr>
						<td rv-each-event="swap.sessions">
							<strong rv-html="event.title"></strong><br>
							</p>
						</td>
					</tr>
					<tr>
						<td rv-each-event="swap.sessions">
							<em rv-html="event.speakers"></em>
						</td>
					</tr>
					<tr>
						<td rv-each-event="swap.sessions">
							{event.start | date} - {event.end | date}
						</td>
					</tr>
				</table>
				<button class="btn btn-default btn-block" rv-enabled="swap.enabled" rv-on-click="actions.swap">Swap</button>
			</div>
		</div>
	</div>
</div>
</div>

<div class="clearfix"></div>

<div id="calendar"></div>

<script type="text/javascript">
define('SessionConfig', function(){
    return <f:format.raw>{jsconf}</f:format.raw>;
});
require(['TYPO3/CMS/Sessions/SessionModule', 'jquery', 'jquery-ui/draggable'], function(cal, jQuery, draggable) {
	jQuery(document).ready(function($) {
		cal.initialize();
		// make external events droppable
		$('#unassigned-sessions .unscheduled-event').each(function() {
			// store data so the calendar knows to render an event upon drop
			var eventData = {
				title: $(this).data('title'),
				id: $(this).data('id'),
				stick: true
			 };
			$(this).data('event', eventData);
			// make the event draggable using jQuery UI
			$(this).draggable({
				zIndex: 999,
				revert: true,
				revertDuration: 0
			});

		});

	});
});
</script>
